<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Simmons+Simmons Luke Agent</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
      body {
        font-family: system-ui, Arial, sans-serif;
        margin: 2rem;
        line-height: 1.6;
        background: #f9fafb;
        color: #111827;
        text-align: center;
      }
      h1 {
        font-size: 2rem;
        margin-bottom: 1rem;
      }
      img.logo {
        max-width: 100%;
        height: auto;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        margin: 1.5rem 0;
      }
      p {
        max-width: 600px;
        margin: 0 auto;
      }
    </style>
  </head>
  <body>
  

    <!-- Logo image -->
    <img class="logo" src="https://www.aspiringsolicitors.co.uk/wp-content/uploads/2020/05/SimmonsSimmons_Coral-scaled.jpg" alt="Legal Engine Logo" />

 <!-- Webhook widget: set your webhook URL/method/token here via data-* attributes -->
    <div
      id="le-webhook-widget"
      class="webhook-fab"
      data-url="https://leonard-dev.app.n8n.cloud/webhook/simmons-luke"   <!-- ← CHANGE THIS -->
      data-method="POST"                        <!-- POST or GET -->
    >
      <button id="le-webhook-btn" class="webhook-btn">Click Here -> </button>
      <a id="le-webhook-link" class="webhook-link" target="_blank" rel="noopener">Test n8n Flow</a>
    </div>
    <div id="le-webhook-log" class="webhook-log" aria-live="polite"></div>

    <script>
      (function () {
        const widget = document.getElementById('le-webhook-widget');
        const btn = document.getElementById('le-webhook-btn');
        const link = document.getElementById('le-webhook-link');
        const log = document.getElementById('le-webhook-log');

        // Configure defaults and read from data-* attributes
        const config = {
          url: widget?.dataset.url || 'https://example.com/webhook',
          method: (widget?.dataset.method || 'POST').toUpperCase(),
          token: widget?.dataset.token || '',
          getParams: { clicked: 'true', source: 'github-pages' },
          payload: { clicked: true, source: 'github-pages' }
        };

        function showLog(text, type) {
          log.textContent = text;
          log.classList.remove('success', 'error');
          if (type) log.classList.add(type);
          log.classList.add('show');
          clearTimeout(showLog._t);
          showLog._t = setTimeout(() => log.classList.remove('show'), 6000);
        }

        function buildGetUrl() {
          const u = new URL(config.url);
          Object.entries(config.getParams).forEach(([k, v]) => u.searchParams.set(k, v));
          u.searchParams.set('t', Date.now().toString());
          return u.toString();
        }

        function updateLink() {
          try { link.href = buildGetUrl(); }
          catch { link.removeAttribute('href'); }
        }

        async function sendWebhook() {
          const url = config.url;
          const method = config.method;
          if (!url) { showLog('No webhook URL configured.', 'error'); return; }

          btn.disabled = true;
          showLog('Sending…');

          try {
            let res;
            if (method === 'GET') {
              res = await fetch(buildGetUrl(), { method: 'GET' });
            } else {
              const headers = { 'Content-Type': 'application/json' };
              if (config.token) headers['X-Webhook-Token'] = config.token;
              const body = JSON.stringify({ ...config.payload, timestamp: new Date().toISOString() });
              res = await fetch(url, { method: 'POST', headers, body });
            }

            const text = await res.text();
            showLog(`Status: ${res.status} ${res.statusText}\n\n${text}`, res.ok ? 'success' : 'error');
          } catch (err) {
            showLog(`Request failed (likely CORS on receiver):\n\n${err}`, 'error');
          } finally {
            btn.disabled = false;
          }
        }

        // Init
        updateLink();
        btn.addEventListener('click', sendWebhook);
      })();
    </script>
  </body>
</html>
